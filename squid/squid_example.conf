# THIS IS A REFERENCE FILE FOR WHAT WE USE IN PROD SINCE THE PROD CONFIG IS UNTRACKED.
# THE EXAMPLE CREDS ARE EXAMPLES ARE NOT WHAT WE USE IN PROD.
# Basic Squid config for proxying to Rayobyte
# Disable caching to keep it lightweight for scraping
cache deny all
# No local cache storage (disabled by cache deny all)

# Upstream proxy: Rayobyte with auth
# 'login' handles username:password for the parent proxy

# connection-auth on persistent is critical:
# persistent: Explicitly tells Squid to try and keep the connection open. (This is the default in modern Squid versions, but being explicit is good practice).
#connection-auth=on: Instructs Squid to send the Proxy-Authorization header on every request over that single persistent connection. 
# This is critical for proxies that require authentication on every transaction, even over a keep-alive connection.

cache_peer domain.com parent 8000 0 no-query max-conn=10 login=username:password connection-auth=on
# Force all requests through the upstream proxy (no direct connections)
never_direct allow all

# Access control: Allow only from the app_network (Docker bridge network)
# Assumes app_network subnet is 172.18.0.0/16 (based on logs; adjust if needed)
# This restricts to containers on the same network (e.g., app container only)
acl app_network src 172.18.0.0/16
http_access allow app_network
http_access deny all

# Listen on port 3128 (internal only)
http_port 3128

# Logging (for debugging; logs will be in container)
logfile_rotate 0
access_log stdio:/var/log/squid/access.log
cache_log stdio:/var/log/squid/cache.log