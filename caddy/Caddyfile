{
    # This is a global option block.
    # By default, Caddy will use Let's Encrypt for public domains
    # and its own internal CA for local/private domains (like localhost).
}

{$DOMAIN_NAME} {
    {$TLS_DIRECTIVE}

    # Health check endpoints - only accessible from Docker network
    @internal {
        client_ip 172.18.0.0/16  # Docker bridge network range
        path /health
    }
    route @internal {
        reverse_proxy app:8000
    }

    # Main routes with load balancing
     route {
         reverse_proxy {
             to app:8000
             lb_policy least_conn
             health_uri /health
             fail_duration 30s
         }
     }
}
